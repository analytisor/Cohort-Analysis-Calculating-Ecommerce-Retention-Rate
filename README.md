## [**Cohort Analysis for Ecommerce Retention Rate (SQL Query)**](#)

**To view the SQL query:** [Link Here](https://github.com/analytisor/Cohort_analysis_calculating_ecommerce_retention_rate/blob/main/cohort_analysis_sql_query.sql)

### **Visualizations**

#### **Cohort Table**

![Cohort Table](https://github.com/analytisor/Cohort_analysis_calculating_ecommerce_retention_rate/blob/main/cohort_analysis.png)

#### **Cumulative Cohort Table**

![Cumulative Cohort Table](https://github.com/analytisor/Cohort_analysis_calculating_ecommerce_retention_rate/blob/main/cumulative_cohort_analysis.png)

#### **LTV & Cumulative Retention Rate**

![LTV & 90 Day Retention Rate](https://github.com/analytisor/Cohort_analysis_calculating_ecommerce_retention_rate/blob/main/LTV_and_retention_rate.png)

#### **Retention Rate by Each Month**

![Retention Rate by Each Month](https://github.com/analytisor/Cohort_analysis_calculating_ecommerce_retention_rate/blob/main/month_by_month_retention_rate.png)
## **SUMMARY**

This SQL query performs cohort analysis on customer purchase data, providing insights into customer retention, revenue, and lifetime value over time. The analysis aggregates customer behavior into cohort groups and tracks their engagement and purchasing patterns, making it an essential tool for understanding long-term customer retention and revenue trends.

### **Metrics and Dimensions**

**Key Metrics:**
- Customer Retention Rate
- Revenue per Cohort
- Cumulative Customer Count
- Lifetime Value (LTV)
- Repeat Purchases

**Key Dimensions:**
- **Cohort Group:** Grouped by customer acquisition date
- **Time Period:** Displayed by months since acquisition (e.g., Month 1, Month 2, etc.)
- **Revenue Per Cohort:** Sum of revenue generated by each cohort
- **Cumulative Metrics:** Aggregated repeat purchases and cumulative revenue over time

### **Key Components of the Query**

- **CTEs (Common Table Expressions):**  
  A modular and structured approach, breaking down the query into readable segments for easier management and updating.
  
- **Window Functions:**  
  Used for calculating cumulative metrics such as retention and revenue over time.

- **Conditional Logic:**  
  Adjusts results based on the current date, ensuring accurate calculations for incomplete months.

### **CTEs Used**

- **customer_purchases:**  
  Preprocesses sales data to identify key purchase details.
  
- **customer_cohorts:**  
  Groups customers into cohorts based on their acquisition date.

- **cohort_analysis:**  
  Performs detailed, per-customer analysis, including repeat purchases and LTV tracking.

- **aggregated_cohorts:**  
  Summarizes cohort data to provide aggregated metrics.

- **cumulative_data:**  
  Tracks cumulative metrics, ensuring non-decreasing retention and revenue calculations.

### **Challenges Addressed**

- **Cumulative Calculations:**  
  Ensures that the count of unique repeat customers remains non-decreasing across months.
  
- **Handling Incomplete Months:**  
  Ensures that incomplete months are handled correctly by displaying `0` for metrics in months that are not yet completed.

### **Usage**

To use this script, execute it in your SQL database environment. Ensure that the `ECOM2.sales` table contains the necessary columns and data. After execution, the resulting `ECOM2.cohorts` table will provide detailed cohort analysis metrics, offering a comprehensive view of customer retention and revenue trends over time.

### **Contributing**

Contributions are welcome! If you have suggestions or improvements, please submit a pull request or open an issue.
